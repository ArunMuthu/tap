var fs = require('fs'),
    io = require('socket.io'),
    net = require('net'),
    sys = require('util'),
    url = require('url'),
    http = require('http'),
    path = require('path'),
    mime = require('mime'),
    redis = require('redis');

var users =[];

var app = require('express')()
var server = http.createServer(app)
io = io.listen(server);

server.listen(8000);

var db = redis.createClient(6379, "127.0.0.1");
var dbAuth = function() { db.auth();console.log("redis connected"); }
db.addListener('connected', dbAuth);
db.addListener('reconnected', dbAuth);
dbAuth();

app.get('/streams/log', function (req, res) {
  res.sendfile(__dirname + '/index.html');
                      db.subscribe("logstash", function(channel, message) {
                       try { console.log("subscribed"); } catch (SyntaxError) { return false; }
                    });
});


app.get('/streams/syslog', function (req, res) {
  res.sendfile(__dirname + '/index.html');
                      db.subscribe("syslog", function(channel, message) {
                       try { console.log("subscribed"); } catch (SyntaxError) { return false; }
                    });
});




io.sockets.on('connection', function (socket) {
     
      
     db.on("message", function (channel,message) {
                    console.log("broadcast");
                    console.log(""+channel);
                   socket.emit("message",message);
                  });
   console.log("Socket id =>"+socket.id);
  socket.emit("message","helllo");
  socket.on('my other event', function (data) {
    console.log(data);
  });
});
